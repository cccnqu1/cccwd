<html>
<head>
  <meta charset="utf-8" />
</head>
<body>
<script src="../../gospa.js"></script>
<title> 陳鍾誠  / 教科書  / Web 程式設計 / JavaScript 的字串處理</title>

 [[陳鍾誠]](ccc:home)  / [[教科書]](book:home)  / [[Web 程式設計]](wp:home) 

<h1 id="javascript">JavaScript 的字串處理</h1>

<h2 id="string">字串物件 String</h2>

<p>String 物件的成員</p>

<table>
<thead>
<tr>
<th id="屬性/函數" style="text-align:left;"> 屬性/函數 </th>
<th id="說明" style="text-align:left;"> 說明 </th>
<th id="範例" style="text-align:left;"> 範例 </th>
<th id="結果" style="text-align:left;"> 結果 </th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align:left;"><p>constructor </p></td>
<td style="text-align:left;"><p>傳回建構函數 </p></td>
<td style="text-align:left;"><p>"Hello".constructor </p></td>
<td style="text-align:left;"><p>function String() { [native code] } </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>length </p></td>
<td style="text-align:left;"><p>傳回長度 </p></td>
<td style="text-align:left;"><p>"Hello".length </p></td>
<td style="text-align:left;"><p>function String() { [native code] } </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>prototype </p></td>
<td style="text-align:left;"><p>傳回原型 </p></td>
<td style="text-align:left;"><p>"Hello".prototype </p></td>
<td style="text-align:left;"><p>undefined </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>charAt() </p></td>
<td style="text-align:left;"><p>傳回第 i 個字元 </p></td>
<td style="text-align:left;"><p>"Hello".charAt(1) </p></td>
<td style="text-align:left;"><p>e </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>charCodeAt() </p></td>
<td style="text-align:left;"><p>傳回第 i 個字元的 Unicode </p></td>
<td style="text-align:left;"><p>"Hello".charCodeAt(1) </p></td>
<td style="text-align:left;"><p>101 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>concat() </p></td>
<td style="text-align:left;"><p>連接兩個以上的字串 </p></td>
<td style="text-align:left;"><p>"Hello".concat(" World", " !") </p></td>
<td style="text-align:left;"><p>Hello World ! </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>fromCharCode() </p></td>
<td style="text-align:left;"><p>將 Unicode 代碼轉為字元 </p></td>
<td style="text-align:left;"><p>"Hello".fromCharCode(101, 102) </p></td>
<td style="text-align:left;"><p>ef </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>indexOf() </p></td>
<td style="text-align:left;"><p>傳回子字串的位置 </p></td>
<td style="text-align:left;"><p>"Hello".indexOf("el") </p></td>
<td style="text-align:left;"><p>1 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>lastIndexOf() </p></td>
<td style="text-align:left;"><p>傳回子字串的位置 (倒著掃瞄) </p></td>
<td style="text-align:left;"><p>"Hello".lastIndexof("l") </p></td>
<td style="text-align:left;"><p>3 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>match() </p></td>
<td style="text-align:left;"><p>搜尋正規表達式 </p></td>
<td style="text-align:left;"><p>"Hello".match("[aeiou]") </p></td>
<td style="text-align:left;"><p>2 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>replace() </p></td>
<td style="text-align:left;"><p>取代正規表達式 </p></td>
<td style="text-align:left;"><p>"Hello".replace("l", "L") </p></td>
<td style="text-align:left;"><p>HeLLo </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>search() </p></td>
<td style="text-align:left;"><p>搜尋正規表達式 </p></td>
<td style="text-align:left;"><p>"Hello".search("[aeiou]") </p></td>
<td style="text-align:left;"><p>e </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>slice() </p></td>
<td style="text-align:left;"><p>切出字串 </p></td>
<td style="text-align:left;"><p>"Hello".slice(-3) </p></td>
<td style="text-align:left;"><p>llo </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>split() </p></td>
<td style="text-align:left;"><p>分割字串 </p></td>
<td style="text-align:left;"><p>"Hello".split("e") </p></td>
<td style="text-align:left;"><p>H,llo </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>substr() </p></td>
<td style="text-align:left;"><p>取出 from 長 len 的子字串 </p></td>
<td style="text-align:left;"><p>"Hello".substr(2,2) </p></td>
<td style="text-align:left;"><p>ll </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>substring() </p></td>
<td style="text-align:left;"><p>取出 from 到 to 的子字串 </p></td>
<td style="text-align:left;"><p>"Hello".substring(2,4) </p></td>
<td style="text-align:left;"><p>llo </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>toLowerCase() </p></td>
<td style="text-align:left;"><p>轉為小寫 </p></td>
<td style="text-align:left;"><p>"Hello".toLowerCase() </p></td>
<td style="text-align:left;"><p>hello </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>toUpperCase() </p></td>
<td style="text-align:left;"><p>轉為大寫 </p></td>
<td style="text-align:left;"><p>"Hello".toUpperCase() </p></td>
<td style="text-align:left;"><p>HELLO </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>valueOf() </p></td>
<td style="text-align:left;"><p>傳回原型值 </p></td>
<td style="text-align:left;"><p>"Hello".valueOf() </p></td>
<td style="text-align:left;"><p>Hello </p></td>
</tr>

</tbody>
</table>

<p>程式範例</p>

<pre><code class="html">&lt;html&gt;
&lt;body&gt;
&lt;script type="text/javascript"&gt;
var s = "Hello";
document.write("s = 'Hello'");
document.write("s.constructor = "+s.constructor+"&lt;BR/&gt;");
document.write("s.length = "+s.length+"&lt;BR/&gt;");
document.write("s.prototype = "+s.prototype+"&lt;BR/&gt;");
document.write("s.charAt(1) = "+s.charAt(1)+"&lt;BR/&gt;");
document.write("s.charCodeAt(1) = "+s.charCodeAt(1)+"&lt;BR/&gt;");
document.write("s.concat(' World', ' !') = "+s.concat(' World', ' !')+"&lt;BR/&gt;");
document.write("String.fromCharCode(72,69,76,76,79) = "+String.fromCharCode(72,69,76,76,79)+"&lt;BR/&gt;");
document.write("s.indexOf('el') = "+s.indexOf('el')+"&lt;BR/&gt;");
document.write("s.lastIndexOf('l') = "+s.lastIndexOf('l')+"&lt;BR/&gt;");
document.write("s.match('[aeiou]') = "+s.match('[aeiou]')+"&lt;BR/&gt;");
document.write("s.replace('l', 'L') = "+s.replace('l', 'L')+"&lt;BR/&gt;");
document.write("s.search('[aeiou]') = "+s.search('[aeiou]')+"&lt;BR/&gt;");
document.write("s.slice(2,4) = "+s.slice(2,4)+"&lt;BR/&gt;");
document.write("s.slice(2) = "+s.slice(2)+"&lt;BR/&gt;");
document.write("s.slice(-3) = "+s.slice(-3)+"&lt;BR/&gt;");
document.write("s.split('e') = "+s.split('e')+"&lt;BR/&gt;");
document.write("s.substr(2,2) = "+s.substr(2,2)+"&lt;BR/&gt;");
document.write("s.substring(2,4) = "+s.substr(2,4)+"&lt;BR/&gt;");
document.write("s.toLowerCase() = "+s.toLowerCase()+"&lt;BR/&gt;");
document.write("s.toUpperCase() = "+s.toUpperCase()+"&lt;BR/&gt;");
document.write("s.valueOf() = "+s.valueOf()+"&lt;BR/&gt;");
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>執行結果</p>

<pre><code>s = 'Hello's.constructor = function String() { [native code] }
s.length = 5
s.prototype = undefined
s.charAt(1) = e
s.charCodeAt(1) = 101
s.concat(' World', ' !') = Hello World !
String.fromCharCode(72,69,76,76,79) = HELLO
s.indexOf('el') = 1
s.lastIndexOf('l') = 3
s.match('[aeiou]') = e
s.replace('l', 'L') = HeLlo
s.search('[aeiou]') = 1
s.slice(2,4) = ll
s.slice(2) = llo
s.slice(-3) = llo
s.split('e') = H,llo
s.substr(2,2) = ll
s.substring(2,4) = llo
s.toLowerCase() = hello
s.toUpperCase() = HELLO
s.valueOf() = Hello
</code></pre>

<h2 id="">正規表達式</h2>

<p>正規語法 (Regular Grammar) 是一種用來比對字串的語法，這種語法被引入 Perl 語言之後成為重要的程式設計工具。
此種標準的正規語法後來被稱為正則表達式 (Regular Expression)。目前，大部分的語言都已納入正則表達式的函式庫，
正規表達是可以說是程式設計師必定要瞭解的工具，也就是常識的一部分。系統程式設計師更應該要瞭解正則表達式，
因為正規語法是程式語言當中，用來描述基本詞彙 (Vocabulary)，並據以建構詞彙掃描器(Lexer)的基礎語法，
Lexer 是編譯器的基本元件之一。</p>

<p>假如我們要用正則表達式描述整數數字，那麼，可以用 <code>[0123456789]+</code> 這個表達式，其中的中括號 <code>[</code> 與 <code>]</code> 會框住一群
字元，用來代表字元群，加號 <code>+</code> 所代表的是重複 1 次或以上，因此，該表達式就可以描述像 3702451 這樣的數字。
然而，在正則表達式中，為了更方便撰寫，於是允許用 <code>[0-9]+</code> 這樣的式子表達同樣的概念，其中的 0-9 其實就
代表了 0123456789 等字元，這是一種簡便的縮寫法。甚至可以再度縮短後以 <code>[\d]+</code> 代表，其中的 <code>\d</code>    就代表
數字所成的字元集合。</p>

<p>利用範例學習是理解正則表達式的有效方法，表格 1 就顯示了一些具有代表性的正則表達式範例。</p>

<p>表格 1. 正則表達式的範例</p>

<table>
<thead>
<tr>
<th id="語法" style="text-align:left;"> 語法                 </th>
<th id="正規表達式" style="text-align:left;">    正規表達式             </th>
<th id="範例" style="text-align:left;">           範例 </th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align:left;"><p>整數                  </p></td>
<td style="text-align:left;"><p><code>[0-9]+</code>                      </p></td>
<td style="text-align:left;"><p>3704 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>有小數點的實數 </p></td>
<td style="text-align:left;"><p><code>[0-9]+\.[0-9]+</code> </p></td>
<td style="text-align:left;"><p>7.93 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>英文詞彙              </p></td>
<td style="text-align:left;"><p><code>[A-Za-z]+</code>                 </p></td>
<td style="text-align:left;"><p>Code </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>變數名稱              </p></td>
<td style="text-align:left;"><p><code>[A-Za-z_][A-Za-z0-9_]*</code> </p></td>
<td style="text-align:left;"><p>_counter </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>Email                  </p></td>
<td style="text-align:left;"><p><code>[a-zA-Z0-9_]+@[a-zA-Z0-9\._]+</code> </p></td>
<td style="text-align:left;"><p>ccc@kmit.edu.tw </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>URL                   </p></td>
<td style="text-align:left;"><p><code>http://[a-zA-Z0-9\./_]+</code>   </p></td>
<td style="text-align:left;"><p>http://ccc.kmit.edu.tw/mybook/ </p></td>
</tr>

</tbody>
</table>

<p>為了協助讀者理解這些範例，我們有必要對範例中的一些正規表達式符號進行說明。</p>

<p>在實數的範例中，使用 <code>\.</code> 代表小數點符號 .，不熟悉正則表達式的讀者一定覺得奇怪，為何要加上斜線符號 <code>\</code> 呢？
這是因為在正則表達式當中，有許多符號具有特殊意義，例如點符號 <code>.</code> 是用來表示任意字元的，星號 <code>*</code> 是代表 0 次
或以上，加號 <code>+</code> 代表一次或以上，在正則表達式當中，有許多這類的特殊字元，因此用斜線 <code>\</code> 代表跳出字元，就像
C 語言當中 printf 函數內的用途一樣。因此，當我們看到 <code>\</code> 符號時，必須繼續向後看，才能知道其所代表的意義。
表格 2 列出了正則表達式當中大部份的重要符號之意義，以供讀者參考。</p>

<p>表格 2. 正則表達式當中的符號之意義</p>

<table>
<thead>
<tr>
<th id="字元" style="text-align:left;"> 字元 </th>
<th id="描述" style="text-align:left;"> 描述 </th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align:left;"><p>^ </p></td>
<td style="text-align:left;"><p>比對開始位置 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>$ </p></td>
<td style="text-align:left;"><p>比對結束位置。</p></td>
</tr>

<tr>
<td style="text-align:left;"><ul>
<li></li>
</ul></td>
<td style="text-align:left;"><p>零次或以上 </p></td>
</tr>

<tr>
<td style="text-align:left;"><ul>
<li></li>
</ul></td>
<td style="text-align:left;"><p>一次或以上 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>? </p></td>
<td style="text-align:left;"><p>零次或一次 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>{n} </p></td>
<td style="text-align:left;"><p>n 次。 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>{n,} </p></td>
<td style="text-align:left;"><p>n 次或以上 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>{n,m} </p></td>
<td style="text-align:left;"><p>n 到 m 次 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>? </p></td>
<td style="text-align:left;"><p>非貪婪模式 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>. </p></td>
<td style="text-align:left;"><p>比對除"\n"之外字元 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>(?:pattern) </p></td>
<td style="text-align:left;"><p>比對 pattern 樣式 </p></td>
</tr>

<tr>
<td style="text-align:left;"><p>(?=pattern) </p></td>
<td style="text-align:left;"><p>正向預查，例如，Windows (?=95)  可比對到 "Windows 95" 中的 "Windows"，但不能比對 Windows XP 中的 Windows。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>(?!pattern) </p></td>
<td style="text-align:left;"><p>負向預查，例如 Windows(?!95) 能比對 "Windows XP"中的 "Windows"，但不能比對 "Windows 95" 中 的"Windows"。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>x ｜y </p></td>
<td style="text-align:left;"><p>比對 x 或 y。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>[xyz] </p></td>
<td style="text-align:left;"><p>包含 xyz 等字元。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>[^xyz] </p></td>
<td style="text-align:left;"><p>不包含 xyz 等字元。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>[a-z] </p></td>
<td style="text-align:left;"><p>字元範圍 a-z。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>[^a-z] </p></td>
<td style="text-align:left;"><p>不包含字元範圍 a-z。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\b </p></td>
<td style="text-align:left;"><p>比對一個單詞邊界，也就是指單詞和空格間的位置。例如，"er\b"可以比對"never"中的"er"，但不能比對"verb"中的"er"。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\B </p></td>
<td style="text-align:left;"><p>比對非單詞邊界。"er\B"能比對"verb"中的"er"，但不能比對"never"中的"er"。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\cx </p></td>
<td style="text-align:left;"><p>比對由x指明的控制字元。例如，\cM比對一個Control-M或回車符。x的值必須為A-Z或a-z之一。否則，將c視為一個原義的"c"字元。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\d </p></td>
<td style="text-align:left;"><p>比對一個數位字元。等價於[0-9]。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\D </p></td>
<td style="text-align:left;"><p>比對一個非數位字元。等價於[^0-9]。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\f </p></td>
<td style="text-align:left;"><p>比對一個換頁符。等價於\x0c和\cL。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\n </p></td>
<td style="text-align:left;"><p>比對一個分行符號。等價於\x0a和\cJ。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\r </p></td>
<td style="text-align:left;"><p>比對一個回車符。等價於\x0d和\cM。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\s </p></td>
<td style="text-align:left;"><p>比對任何空白字元，包括空格、定位字元、換頁符等等。等價於[\f\n\r\t\v]。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\S </p></td>
<td style="text-align:left;"><p>比對任何非空白字元。等價於[^\f\n\r\t\v]。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\t </p></td>
<td style="text-align:left;"><p>比對一個定位字元。等價於\x09和\cI。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\v </p></td>
<td style="text-align:left;"><p>比對一個垂直定位字元。等價於\x0b和\cK。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\w </p></td>
<td style="text-align:left;"><p>比對包括底線的任何單詞字元。等價於"[A-Za-z0-9_]"。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\W </p></td>
<td style="text-align:left;"><p>比對任何非單詞字元。等價於"[^A-Za-z0-9_]"。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\xn </p></td>
<td style="text-align:left;"><p>比對n，其中n為十六進位轉義值。十六進位轉義值必須為確定的兩個數位長。例如，"\x41"比對"A"。"\x041"則等價於"\x04"&amp;"1"。規則運算式中可以使用ASCII編碼。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\num </p></td>
<td style="text-align:left;"><p>比對num，其中num是一個正整數。對所獲取的比對的引用。例如，"(.)\1"比對兩個連續的相同字元。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\n </p></td>
<td style="text-align:left;"><p>標識一個八進制轉義值或一個向後引用。如果\n之前至少n個獲取的子運算式，則n為向後引用。否則，如果n為八進位數字(0-7)，則n為一個八進制轉義值。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\nm </p></td>
<td style="text-align:left;"><p>標識一個八進制轉義值或一個向後引用。 如果\nm之前至少有nm個獲得子運算式，則nm為向後引用。如果\nm之前至少有n個獲取，則n為一個後跟文字m的向後引用。如果前面的條件都不滿足，若n和m均為八進位數字(0-7)，則\nm 將比對八進制轉義值nm。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\nml </p></td>
<td style="text-align:left;"><p>如果n為八進位數字(0-3)，且m和l均為八進位數字(0-7)，則比對八進制轉義值nml。</p></td>
</tr>

<tr>
<td style="text-align:left;"><p>\un </p></td>
<td style="text-align:left;"><p>比對n，其中n是一個用四個十六進位數位表示的Unicode字元。例如，\u00A9比對版權符號（©）。</p></td>
</tr>

</tbody>
</table>

<pre><code class="javascript">&lt;html&gt;
&lt;body&gt;

&lt;script type="text/javascript"&gt;
document.write("&lt;pre&gt;\n");
String.prototype.trim = function() { return this.replace(/(^\s*)|(\s*$)/g, ""); }
document.write("' abc '.trim()=|"+' abc '.trim()+"|\n");
var re = new RegExp("\\d+", "gi");
var str = "name:john age:20 birthday:1990/8/31";
var m = null;
while (m = re.exec(str))
  document.write(m + "\n");
var p = parse(str);
document.write("p.name="+p.name+" age="+p.age+" year="+p.year+" month="+p.month+" day="+p.day);
document.write("&lt;/pre&gt;\n");

function parse(data) {
    var e=new RegExp("name:(\\w+) age:(\\d+) birthday:(\\d+)/(\\d+)/(\\d+)", "gi");

    if (data.match(e)) {
        return  {exp: RegExp['{%=wdHtml%}amp;'],
                name: RegExp.$1,
                age:RegExp.$2,
                year:RegExp.$3,
                month:RegExp.$4,
                day:RegExp.$5};
    }
    else {
        return null;
    }
}
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>執行結果</p>

<pre><code>' abc '.trim()=|abc|
20
1990
8
31
p.name=john age=20 year=1990 month=8 day=31
</code></pre>

<h2 id="eval">eval 函數 -- 解譯字串中的程式</h2>

<pre><code class="JavaScript">&lt;script type="text/javascript"&gt;
var a=3, b=5;
alert('a+b='+eval('a+b'));
&lt;/script&gt;
</code></pre>

<h2 id="">參考文獻</h2>

<ul>
<li>Wikipedia:Regular expression -- http://en.wikipedia.org/wiki/Regular_expression</li>
<li>維基百科:正規表式 -- http://zh.wikipedia.org/zh-tw/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F</li>
<li>鳥哥的 Linux 私房菜:第十二章、正規表示法與文件格式化處理 -- http://linux.vbird.org/linux_basic/0330regularex.php</li>
<li>石頭閒語:Regular Expression (RegExp) in JavaScript -- http://blog.roodo.com/rocksaying/archives/2670695.html</li>
<li>字串樣版 Regexp: 兼談長線學習投資 -- http://www.cyut.edu.tw/~ckhung/b/re/</li>
<li>在 C 程式中，使用 Regex (Regular Expression) library -- http://blog.roodo.com/rocksaying/archives/3866523.html</li>
</ul>

</body>
</html>