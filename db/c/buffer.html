<html>
<head>
  <meta charset="utf-8" />
</head>
<body>
<script src="../../gospa.js"></script>
<title> 陳鍾誠  / 教科書  / C 語言 / 檔案緩衝區 -- 如何指定緩衝區大小與位址</title>

 [[陳鍾誠]](ccc:home)  / [[教科書]](book:home)  / [[C 語言]](c:home) 

<h2 id="">檔案緩衝區 -- 如何指定緩衝區大小與位址</h2>

<p>在 C 語言的標準輸出入函式庫中，您可以使用 setbuf(file, buffer) 的方法，設定擋案的緩衝區，如果您用 setbuf(file, NULL) 這個函數將緩衝區設為 NULL，就會取消檔案緩衝機制，每次都直接輸出到檔案中。</p>

<p>另外，您也可以使用 setvbuf(file, buffer, mode, size) 這樣的方式，設定檔案緩衝區與緩衝模式，其中的 mode 有三種可能，第一種 _IOFBF 代表完全緩衝，該模式會等緩衝區滿了之後再輸出，第二種 _IOLBF 代表行緩衝 (line buffered)，一但碰到換行時就會輸出，而第三種 _IONBF 代表不緩衝，該方法會完全不進行緩衝而直接輸出。</p>

<h3 id="">程式範例</h3>

<p>檔案：setbuf.c</p>

<pre><code class="CPP">#include &lt;stdio.h&gt;

int main () {
  char buffer[BUFSIZ];  // BUFSIZ 定義在 stdio.h 當中。
  FILE *file;
  file=fopen ("test.txt","w");
  setbuf (file, buffer ); // setbuf(file, NULL) 會取消緩衝區，每次都直接輸出入。
  fclose (file);
  return 0;
}
</code></pre>

<h3 id="">執行結果</h3>

<pre><code>D:\cp&gt;gcc setbuf.c -o setbuf

D:\cp&gt;setbuf
</code></pre>

</body>
</html>